!function(e,t,n){function s(){t.removeEventListener("DOMContentLoaded",r,!1),e.removeEventListener("load",r,!1)}function i(e,t){for(var n=e.getElementsByTagName(t),s=n.length-1;s>=0;--s)n[s].removeAttribute("id"),n[s].setAttribute("class",n[s].getAttribute("class").split(" ")[0])}function a(e){for(var t=e.getElementsByTagName("li"),n=0;n<t.length;++n)t[n].lastChild.onclick=function(e){e.stopPropagation(),S(ct,_(e.target.parentNode).slice(0,-1)),k(rt,50)},t[n].onclick=function(e){f("php/ajax/setCurrentUser.php",function(){4===this.readyState&&200===this.status&&("1"===this.responseText?T():w(this.responseText))},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{usNick:_(e.target).slice(0,-1)})}}function o(){var e=!1,t=Math.floor(new Date/1e3);if(null===vt[0]?(vt[0]=t,vt[1]=t):(vt[1]=vt[0],vt[0]=t),vt[0]-2<=vt[1])mt[1]=5;else if(vt[0]-3===vt[1])mt[1]=10;else if(vt[0]-4===vt[1])mt[1]=15;else{if(vt[0]-5!==vt[1])return mt[0]=1,!1;mt[1]=20}switch(mt[1]){case 5:mt[0]>=5?e=!0:5===mt[2]?++mt[0]:mt[2]=5;break;case 10:mt[0]>=10?e=!0:10===mt[2]?++mt[0]:mt[2]=10;break;case 15:mt[0]>=15?e=!0:15===mt[2]?++mt[0]:mt[2]=15;break;case 20:mt[0]>=20?e=!0:20===mt[2]?++mt[0]:mt[2]=20}return e}function r(){var e={W_0:"No unsolicited connected users",W_1:"Spam detected, please try in a few seconds",W_2:"You can't create more rooms, please delete to recreate another one",W_3:"Cannot delete active user, please retry in a minute",W_4:"The chosen nickname doesn't exists or or deleted",W_5:"Unknown error code",W_6:"Server side has occurred, please try again later",W_7:"The system detected an invalid operation",W_8:"Error code",W_9:"Error closing",W_10:"The server failed to Identify your request"},n={W_0:"לא נמצאו משתמשים מחוברים שלא הוזמנו",W_1:"המערכת זיהתה ספאם אנא נסה/י שנית בעוד מספר שניות",W_2:"הגעת למכסת החדרים המותרת לכל משתמש, תוכל/י למחוק חדרים וליצור חדשים",W_3:"אין באפשרות המערכת למחוק משתמש פעיל, אנא עצור את פעילות המשתמש ונסה/י שנית כעבור כדקה",W_4:"הכינוי הנבחר אינו קיים או נמחק",W_5:"קוד שגיאה לא מוכר",W_6:"שגיאת שרת התרחשה, אנא נסהי במועד מאוחר יותר",W_7:"המערכת זיהתה פעולה לא חוקית",W_8:"קוד שגיאה",W_9:"סגירת שגיאה",W_10:"השרת נכשל בזיהוי בקשתך"};switch(t.getElementById("lang").value){case"he":dt=n;break;default:dt=e}s(),C=t.getElementById("chatForm"),U=t.getElementById("errorParagraph");var i=t.getElementById("closeErrorParagraph");if(null!==i&&(i.onclick=function(){E(U,50)}),null!==C)N=t.getElementById("messagesContainer"),P=t.getElementById("communicationSection"),O=t.getElementById("message"),R=t.getElementById("usersTable"),L=t.getElementById("roomsList"),l(L,"*",gt),j=t.getElementById("cancelRoomDiv"),F=t.getElementById("approveRoomDiv"),A=t.getElementById("newRoomDiv"),$=t.getElementById("userToInvite"),H=t.getElementById("newInvitationDiv"),K=t.getElementById("cancelInvitationDiv"),q=t.getElementById("approveInvitationDiv"),X=t.getElementById("invitationForm"),z=t.getElementById("newKickDiv"),Y=t.getElementById("cancelKickDiv"),G=t.getElementById("approveKickDiv"),J=t.getElementById("kickMe"),Q=t.getElementById("newRoomDeletionDiv"),V=t.getElementById("cancelRoomDeletionDiv"),Z=t.getElementById("approveRoomDeletionDiv"),tt=t.getElementById("deleteThisRoom"),et=t.getElementById("roomDeletionForm"),Z.onclick=function(){u(!0,Q)},V.onclick=function(){u(!1,Q)},G.onclick=function(){h(!0,z)},Y.onclick=function(){h(!1,z)},F.onclick=function(){y(!0,A)},j.onclick=function(){y(!1,A)},q.onclick=function(){d(!0,H)},K.onclick=function(){d(!1,H)},O.onkeyup=function(){x(O,ut.usMessage)},setInterval(function(){f("php/ajax/getData.php",function(){if(4===this.readyState&&200===this.status)if("-1"===this.responseText)T();else{var e,n=this.responseText.split("SEP"),s=n[0],i=n[1],a=n[2],o=n[3],r=parseInt(n[4]),l=t.getElementById("currentRoom");e=null!==l?_(l):"*",I(s,gt),B(gt,e),v(L,r),p(L,a,o,e),R.innerHTML=i,b(R),W(L,gt)}},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{ajaxCounter:ht}),++ht},2e3),C.onsubmit=function(){return o()?w(2):ut.usMessage.test(O.value)&&O.value.trim().length>0?f("php/ajax/addMessage.php",function(){4===this.readyState&&200===this.status&&("1"!==this.responseText&&w(7),O.value="",x(O,ut.usMessage))},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{usMessage:O.value}):(x(O,ut.usMessage),O.focus()),!1};else{nt=t.getElementById("registrationForm");var r=t.getElementById("mainUserSelection");null!==nt&&(nt=t.getElementById("registrationForm"),st=t.getElementById("usNick"),it=t.getElementById("newCodeButton"),at=t.getElementById("usCode"),ot=t.getElementById("codeImg"),it.onclick=function(){ot.src="php/captcha.php?cM="+new Date/1e3},st.onkeyup=function(){x(st,ut.usNick)},nt.onsubmit=function(){return ut.usNick.test(st.value)?!0:(x(st,ut.usNick),st.focus(),at.src="php/captcha.php?cM="+new Date/1e3,!1)}),null!==r&&(rt=t.getElementById("newUserDeletionDiv"),lt=t.getElementById("cancelUserDeletionDiv"),ct=t.getElementById("deleteMe"),pt=t.getElementById("approveUserDeletionDiv"),pt.onclick=function(){g(!0,rt)},lt.onclick=function(){g(!1,rt)},a(r))}}function l(e,t,n){f("php/ajax/validRoom.php",function(){4===this.readyState&&200===this.status&&"0"!==this.responseText&&c(e,this.responseText.split("|")[0],this.responseText.split("|")[1],n)},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{roomId:t})}function c(e,t,n,s){var a=D(e,n);a?(i(e,"div"),a.setAttribute("id","currentRoom"),B(s,n),"own"===t&&a.setAttribute("class",a.getAttribute("class")+" withInviteOption")):w(0)}function p(e,s,i,a){for(var o,r,c,p=e.getElementsByTagName("div"),d=0;d<p.length;++d)"invited"===p[d].getAttribute("class")?o=p[d]:"↑↓"===_(p[d])?r=p[d]:"-"===_(p[d])&&(c=d);if(""!==s){yt=!0;var u=M(e),h=t.createElement("div");h.innerHTML=s;for(var y=h.getElementsByTagName("div"),g=0;g<y.length;++g)new RegExp(u).test(_(y[g]))||("invited"===y[g].getAttribute("class")?o===n?e.insertBefore(y[g].cloneNode(!0),null):o.parentNode.insertBefore(y[g].cloneNode(!0),o):"own"===y[g].getAttribute("class")&&r.parentNode.insertBefore(y[g].cloneNode(!0),r.nextSibling))}if(""!==i){yt=!0;for(var f=new RegExp(i),v=p.length-1;v>=0;--v)f.test(_(p[v]))&&(_(p[v])===a&&l(e,"*",gt),gt.splice(_(p[v]),1),e.removeChild(p[v]))}N.style.height=(e.clientHeight>500?e.clientHeight:500)+"px",yt&&(N.scrollTop=N.clientHeight),m(e,c)}function d(e,t){e&&"block"===X.style.display&&f("php/ajax/addInvitation.php",function(){4===this.readyState&&200===this.status&&"1"!==this.responseText&&w(this.responseText)},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{userToInvite:$.value}),E(t,50)}function u(e,t){e&&f("php/ajax/deleteRoom.php",function(){4===this.readyState&&200===this.status&&"1"!==this.responseText&&w(this.responseText)},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{deleteThisRoom:tt.value}),E(t,50)}function h(e,t){e&&f("php/ajax/addKick.php",function(){4===this.readyState&&200===this.status&&"1"!==this.responseText&&w(this.responseText)},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{kickMe:_(J)}),E(t,50)}function y(e,t){e&&f("php/ajax/addNewRoom.php",function(){4===this.readyState&&200===this.status&&"1"!==this.responseText&&w(this.responseText)},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{}),E(t,50)}function g(e,t){e&&f("php/ajax/deleteUser.php",function(){4===this.readyState&&200===this.status&&("1"===this.responseText?T():w(this.responseText))},!0,"POST",{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},{deleteMe:_(ct)}),E(t,50)}function f(t,n,s,i,a,o){var r;r=e.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),r.onreadystatechange=n,r.open(i,t,s);for(var l in a)a.hasOwnProperty(l)&&r.setRequestHeader(l,a[l]);var c="";for(var p in o)o.hasOwnProperty(p)&&(c+=p+"="+o[p]+"&");c=c.slice(0,-1),r.send(c)}function m(e,t){for(var n=e.getElementsByTagName("div"),s="none",i=0;i<n.length;++i)if("own"===n[i].getAttribute("class")||"own withInviteOption"===n[i].getAttribute("class")){s="block";break}n[t].style.display=s}function v(e,t){for(var n,s=e.getElementsByTagName("div"),i=0;i<s.length;++i)if("+"===_(s[i])){n=i;break}s[n].style.display=t>0?"block":"none"}function T(){e.location.href=e.location.protocol+"//"+e.location.host+e.location.pathname}function k(e,t){e.style.display="block";var n=.1,s=setInterval(function(){e.style.opacity=n.toString(),n>1&&clearInterval(s),n+=.1},t)}function E(e,t){for(var n=[],s=e.getElementsByTagName("span"),i=0;i<s.length;++i)n[i]=s[i].onclick,s[i].onclick=null;var a=.9,o=setInterval(function(){if(e.style.opacity=a.toString(),0>a){e.style.display="";for(var t=0;t<s.length;++t)s[t].onclick=n[t];clearInterval(o)}a-=.1},t)}function x(e,t){""===e.value||0===e.value.trim().length?e.setAttribute("class","neutral"):t.test(e.value)?e.setAttribute("class","valid"):e.setAttribute("class","invalid")}function w(e){console.log(e),"string"==typeof e&&(e=0===e.length?19:parseInt(e));var n;switch(e){case-1:T();break;case 0:n=!1;break;case 1:n=!1;break;case 2:n=dt.W_1;break;case 3:n=!1;break;case 4:n=!1;break;case 5:n=!1;break;case 6:n=!1;break;case 7:n=!0;break;case 8:n=!0;break;case 9:n=!1;break;case 10:n=dt.W_2;break;case 11:n=!0;break;case 12:n=!1;break;case 13:n=!0;break;case 14:n=!1;break;case 15:n=dt.W_3;break;case 16:n=!0;break;case 17:n=dt.W_4;break;case 18:n=!1;break;case 19:n=dt.W_10;break;default:n=dt.W_5}n===!0&&(n=dt.W_6),n===!1&&(n=dt.W_7),U.innerHTML=n+",&nbsp;"+dt.W_8+":&nbsp;"+e+'<span title="'+dt.W_9+'" id="closeErrorParagraph">x</span>',t.getElementById("closeErrorParagraph").onclick=function(){E(U,50)},k(U,50)}function I(e,t){var n=e.split("</div>");if(n.pop(),n.length>0){yt=!0;for(var s,i=0;i<n.length;++i)s=ut.idExtractor.exec(n[i])[1],s in t||(t[s]=[]),t[s].push(n[i]+"</div>")}else yt=!1}function b(e){var t,n=e.getElementsByClassName("kick");if(n.length>0)for(var s=0;s<n.length;++s)t=n[s].parentNode,t.onclick=function(e){""===H.style.display&&""===A.style.display&&(S(J,_(e.target.parentNode.firstChild)),k(z,50))}}function B(e,t){var n="*"===t?"0":t;if(n in e){for(var s="",i=0;i<e[n].length;++i)s+=e[n][i];N.innerHTML=s}else N.innerHTML=""}function S(e,t){e.innerText?e.innerText=t:e.textContent=t}function W(e,t){for(var n=e.getElementsByTagName("div"),s=0;s<n.length;++s)n[s].onclick=function(){"+"===_(this)?""===H.style.display&&""===z.style.display&&""===Q.style.display&&k(A,50):"↑↓"===_(this)?f("php/ajax/sessionKill.php",function(){},!0,"POST",{},{}):"-"===_(this)?""===H.style.display&&""===z.style.display&&""===A.style.display&&f("php/ajax/getRooms.php",function(){4===this.readyState&&200===this.status&&("-1"===this.responseText?T():"18"===this.responseText?w(18):(tt.innerHTML=this.responseText,k(Q,50)))},!0,"POST",{},{}):"currentRoom"!==this.id?l(e,_(this),t):"own withInviteOption"===this.getAttribute("class")&&""===A.style.display&&""===z.style.display&&""===Q.style.display&&f("php/ajax/getUsers.php",function(){4===this.readyState&&200===this.status&&("-1"===this.responseText&&T(),""===this.responseText?(X.style.display="none",ft.style.display="block",H.insertBefore(ft,q)):(ft.style.display="none",X.style.display="block",$.innerHTML=this.responseText),k(H,50))},!0,"POST",{},{})}}function _(e){return e.innerText?e.innerText:e.textContent}function D(e,t){var s=e.getElementsByTagName("div");"0"===t&&(t="*");for(var i,a=0;a<s.length;++a)if(_(s[a])===t){i=s[a];break}return i===n?!1:i}function M(e){for(var t,n=e.getElementsByTagName("div"),s="",i=0;i<n.length;++i)t=_(n[i]),"*"!==t&&"+"!==t&&"-"!==t&&"↑↓"!==t&&(s+=t+"|");return"^("+s.slice(0,-1)+")$"}var N,C,P,O,R,L,U,A,j,F,H,K,q,X,$,z,Y,G,J,Q,V,Z,et,tt,nt,st,it,at,ot,rt,lt,ct,pt,dt={},ut={usMessage:/^[\s\S]+$/,usNick:/^[a-zא-ת\d]{2,8}(\s[a-zא-ת\d]{1,8})?$/i,idExtractor:/data\-id="(\d+)"/},ht=0,yt=!1,gt=[],ft=t.createElement("p"),mt=[0,null,null],vt=[null,null];S(ft,dt.W_0),"complete"===t.readyState?r():(t.addEventListener("DOMContentLoaded",r,!1),e.addEventListener("load",r,!1))}(window,document);
//# sourceMappingURL=chat.min.js.map